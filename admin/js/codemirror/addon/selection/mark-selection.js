(function(){function l(a){a.operation(function(){var b=a.getCursor("start"),c=a.getCursor("end");if(0==k(b,c))h(a);else{var d=a.state.markedSelection;if(d.length){var f=d[0].find(),g=d[d.length-1].find();if(!f||!g||c.line-b.line<m||0<=k(b,g.to)||0>=k(c,f.from))n(a);else{for(;0<k(b,f.from);)d.shift().clear(),f=d[0].find();0>k(b,f.from)&&(f.to.line-b.line<m?(d.shift().clear(),e(a,b,f.to,0)):e(a,b,f.from,0));for(;0>k(c,g.to);)d.pop().clear(),g=d[d.length-1].find();0<k(c,g.to)&&(c.line-g.from.line<m?
(d.pop().clear(),e(a,g.from,c)):e(a,g.to,c))}}else e(a,b,c)}})}function p(a){a.state.markedSelection.length&&a.operation(function(){h(a)})}function k(a,b){return a.line-b.line||a.ch-b.ch}function e(a,b,c,d){if(0!=k(b,c))for(var f=a.state.markedSelection,g=a.state.markedSelectionStyle,e=b.line;;){var h=e==b.line?b:q(e,0),e=e+m,l=e>=c.line,n=l?c:q(e,0),h=a.markText(h,n,{className:g});null==d?f.push(h):f.splice(d++,0,h);if(l)break}}function h(a){a=a.state.markedSelection;for(var b=0;b<a.length;++b)a[b].clear();
a.length=0}function n(a){h(a);var b=a.getCursor("start"),c=a.getCursor("end");e(a,b,c)}CodeMirror.defineOption("styleSelectedText",!1,function(a,b,c){c=c&&c!=CodeMirror.Init;b&&!c?(a.state.markedSelection=[],a.state.markedSelectionStyle="string"==typeof b?b:"CodeMirror-selectedtext",n(a),a.on("cursorActivity",l),a.on("change",p)):!b&&c&&(a.off("cursorActivity",l),a.off("change",p),h(a),a.state.markedSelection=a.state.markedSelectionStyle=null)});var m=8,q=CodeMirror.Pos})();
