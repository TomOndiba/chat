(function(){var W=[{keys:["<Left>"],type:"keyToKey",toKeys:["h"]},{keys:["<Right>"],type:"keyToKey",toKeys:["l"]},{keys:["<Up>"],type:"keyToKey",toKeys:["k"]},{keys:["<Down>"],type:"keyToKey",toKeys:["j"]},{keys:["<Space>"],type:"keyToKey",toKeys:["l"]},{keys:["<BS>"],type:"keyToKey",toKeys:["h"]},{keys:["<C-Space>"],type:"keyToKey",toKeys:["W"]},{keys:["<C-BS>"],type:"keyToKey",toKeys:["B"]},{keys:["<S-Space>"],type:"keyToKey",toKeys:["w"]},{keys:["<S-BS>"],type:"keyToKey",toKeys:["b"]},{keys:["<C-n>"],
type:"keyToKey",toKeys:["j"]},{keys:["<C-p>"],type:"keyToKey",toKeys:["k"]},{keys:["C-["],type:"keyToKey",toKeys:["<Esc>"]},{keys:["<C-c>"],type:"keyToKey",toKeys:["<Esc>"]},{keys:["s"],type:"keyToKey",toKeys:["c","l"],context:"normal"},{keys:["s"],type:"keyToKey",toKeys:["x","i"],context:"visual"},{keys:["S"],type:"keyToKey",toKeys:["c","c"],context:"normal"},{keys:["S"],type:"keyToKey",toKeys:["d","c","c"],context:"visual"},{keys:["<Home>"],type:"keyToKey",toKeys:["0"]},{keys:["<End>"],type:"keyToKey",
toKeys:["$"]},{keys:["<PageUp>"],type:"keyToKey",toKeys:["<C-b>"]},{keys:["<PageDown>"],type:"keyToKey",toKeys:["<C-f>"]},{keys:["H"],type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:["M"],type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:["L"],type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:["h"],type:"motion",motion:"moveByCharacters",motionArgs:{forward:!1}},{keys:["l"],type:"motion",motion:"moveByCharacters",
motionArgs:{forward:!0}},{keys:["j"],type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:["k"],type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:["g","j"],type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},{keys:["g","k"],type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:["w"],type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1}},{keys:["W"],type:"motion",motion:"moveByWords",motionArgs:{forward:!0,
wordEnd:!1,bigWord:!0}},{keys:["e"],type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:["E"],type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:["b"],type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1}},{keys:["B"],type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,bigWord:!0}},{keys:["g","e"],type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},
{keys:["g","E"],type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:["{"],type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:["}"],type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:["<C-f>"],type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:["<C-b>"],type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},{keys:["<C-d>"],type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,
explicitRepeat:!0}},{keys:["<C-u>"],type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:["g","g"],type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:["G"],type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:["0"],type:"motion",motion:"moveToStartOfLine"},{keys:["^"],type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},
{keys:["+"],type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0}},{keys:["-"],type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:["_"],type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:["$"],type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:["%"],type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},{keys:["f","character"],type:"motion",motion:"moveToCharacter",
motionArgs:{forward:!0,inclusive:!0}},{keys:["F","character"],type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:["t","character"],type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:["T","character"],type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},{keys:[";"],type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:[","],type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!1}},{keys:["'",
"character"],type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:["`","character"],type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:["]","`"],type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:["[","`"],type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:["]","'"],type:"motion",motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:["[","'"],type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,linewise:!0}},{keys:["]","character"],
type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:["[","character"],type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,toJumplist:!0}},{keys:["|"],type:"motion",motion:"moveToColumn",motionArgs:{}},{keys:["d"],type:"operator",operator:"delete"},{keys:["y"],type:"operator",operator:"yank"},{keys:["c"],type:"operator",operator:"change"},{keys:[">"],type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:["<"],type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},
{keys:["g","~"],type:"operator",operator:"swapcase"},{keys:["n"],type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:["N"],type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:["x"],type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},{keys:["X"],type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},operatorMotionArgs:{visualLine:!0}},{keys:["D"],
type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},operatorMotionArgs:{visualLine:!0}},{keys:["Y"],type:"operatorMotion",operator:"yank",motion:"moveToEol",motionArgs:{inclusive:!0},operatorMotionArgs:{visualLine:!0}},{keys:["C"],type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},operatorMotionArgs:{visualLine:!0}},{keys:["~"],type:"operatorMotion",operator:"swapcase",operatorArgs:{shouldMoveCursor:!0},motion:"moveByCharacters",motionArgs:{forward:!0}},
{keys:["<C-i>"],type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:["<C-o>"],type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:["a"],type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"}},{keys:["A"],type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"eol"}},{keys:["i"],type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"}},{keys:["I"],type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"}},
{keys:["o"],type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0}},{keys:["O"],type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1}},{keys:["v"],type:"action",action:"toggleVisualMode"},{keys:["V"],type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:["J"],type:"action",action:"joinLines",isEdit:!0},{keys:["p"],type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},
{keys:["P"],type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:["r","character"],type:"action",action:"replace",isEdit:!0},{keys:["@","character"],type:"action",action:"replayMacro"},{keys:["q","character"],type:"action",action:"enterMacroRecordMode"},{keys:["R"],type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{replace:!0}},{keys:["u"],type:"action",action:"undo"},{keys:["<C-r>"],type:"action",action:"redo"},{keys:["m","character"],type:"action",action:"setMark"},
{keys:['"',"character"],type:"action",action:"setRegister"},{keys:["z","z"],type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:["z","."],type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["z","t"],type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:["z","<CR>"],type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["z","-"],
type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:["z","b"],type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["."],type:"action",action:"repeatLastEdit"},{keys:["<C-a>"],type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:["<C-x>"],type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:["a","character"],type:"motion",
motion:"textObjectManipulation"},{keys:["i","character"],type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:["/"],type:"search",searchArgs:{forward:!0,querySrc:"prompt",toJumplist:!0}},{keys:["?"],type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:["*"],type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:["#"],type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:[":"],type:"ex"}],
V=function(){function ha(a,b){var c=a.state.vim;c.insertMode||c.exMode||(c=b.head,c.ch&&c.ch==a.doc.getLine(c.line).length&&c.ch--)}function X(a,b){for(var c=[],d=a;d<a+b;d++)c.push(String.fromCharCode(d));return c}function H(a){return/^[A-Z]$/.test(a)}function L(a,b){for(var c=0;c<b.length;c++)if(b[c]==a)return!0;return!1}function Y(a){a.state.vim||(a.state.vim={inputState:new x,lastEditInputState:void 0,lastEditActionCommand:void 0,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},insertMode:!1,
insertModeRepeat:void 0,visualMode:!1,visualLine:!1});return a.state.vim}function ia(){p={searchQuery:null,searchIsReversed:!1,jumpList:Ba(),macroModeState:Ca(),lastChararacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new ja({})}}function x(){this.prefixRepeat=[];this.motionRepeat=[];this.motionArgs=this.motion=this.operatorArgs=this.operator=null;this.keyBuffer=[];this.registerName=null}function D(a,b){this.clear();a&&this.set(a,b)}function ja(a){this.registers=a;this.unamedRegister=
a['"']=new D}function C(a,b,c){var d=Math.min(Math.max(a.firstLine(),b.line),a.lastLine());a=t(a,d)-1;a=c?a+1:a;b=Math.min(Math.max(0,b.ch),a);return{line:d,ch:b}}function M(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function Z(a,b,c){return{line:a.line+b,ch:a.ch+c}}function Da(a,b){for(var c=0;c<a.length;c++)if(a[c]!=b[c]&&"character"!=b[c])return!1;return!0}function ka(a,b,c){return function(){for(var d=0;d<c;d++)b(a)}}function u(a,b){return a.ch==b.ch&&a.line==b.line}function s(a,
b){return a.line<b.line||a.line==b.line&&a.ch<b.ch?!0:!1}function la(a,b,c){a=s(a,b);b=s(b,c);return a&&b}function t(a,b){return a.getLine(b).length}function B(a){a.off("mousedown",B);var b=a.state.vim;b.visualMode=!1;b.visualLine=!1;var b=a.getCursor("anchor"),c=a.getCursor("head");u(b,c)||a.setCursor(C(a,c));CodeMirror.signal(a,"vim-mode-change",{mode:"normal"})}function v(a){if(!a)return 0;var b=a.search(/\S/);return-1==b?a.length:b}function N(a,b,c,d,e){c=a.getCursor();a=a.getLine(c.line);var f=
c.ch,g=a.substring(f);e=e?g.search(/\w/):g.search(/\S/);if(-1==e)return null;f+=e;g=a.substring(f);e=a.substring(0,f);var h;h=d?/^\S+/:/\w/.test(a.charAt(f))?/^\w+/:/^[^\w\s]+/;g=h.exec(g);d=f;f+=g[0].length;e=e.split("").reverse().join("");(h=h.exec(e))&&(d-=h[0].length);b&&(b=a.substring(f).match(/^\s*/)[0].length,0<b?f+=b:(b=e.substring(e.length-d).match(/^\s*/)[0].length,d-=b));return{start:{line:c.line,ch:d},end:{line:c.line,ch:f}}}function ma(a,b){p.lastChararacterSearch.increment=a;p.lastChararacterSearch.forward=
b.forward;p.lastChararacterSearch.selectedCharacter=b.selectedCharacter}function $(a,b,c,d){for(var e=a.getCursor(),f=e.ch,g,h=0;h<b;h++){g=a.getLine(e.line);var k=d,l=void 0;g=l=c?g.indexOf(k,f+1):g.lastIndexOf(k,f-1);if(-1==g)return null;f=g}return{line:a.getCursor().line,ch:g}}function I(a,b,c,d){L(c,Ea)&&(b.marks[c]&&b.marks[c].clear(),b.marks[c]=a.setBookmark(d))}function O(a){return"string"===a||"comment"===a?1:0}function aa(a,b,c){var d=b.line,e=b.ch;c=c?c:a.getLine(d).charAt(e);var f=a.getTokenAt({line:d,
ch:e+1}).type,f=O(f),g={"(":")",")":"(","[":"]","]":"[","{":"}","}":"{"}[c];if(!g)return b;for(var h={"(":1,"{":1,"[":1}[c]||-1,k=1===h?a.lineCount():-1,l=1,n=c,p=e,e=a.getLine(d);d!==k&&0<l;){p+=h;n=e.charAt(p);n||(d+=h,e=a.getLine(d)||"",0<h?p=0:(n=e.length,p=0<n?n-1:0),n=e.charAt(p));var m=a.getTokenAt({line:d,ch:p+1}).type,m=O(m);f>=m&&(n===c?l++:n===g&&l--)}return n?{line:d,ch:p}:b}function ba(a,b,c){var d=a.getCursor();b=aa(a,d,b);a=aa(a,b);a.ch+=c?1:0;b.ch+=c?0:1;return{start:a,end:b}}function na(a,
b,c){var d=a.getCursor();a=a.getLine(d.line).split("");var e,f,g,h;g=a.indexOf(b);d.ch<g?d.ch=g:g<d.ch&&a[d.ch]==b&&(f=d.ch,--d.ch);if(a[d.ch]!=b||f)for(g=d.ch;-1<g&&!e;g--)a[g]==b&&(e=g+1);else e=d.ch+1;if(e&&!f)for(g=e,h=a.length;g<h&&!f;g++)a[g]==b&&(f=g);if(!e||!f)return{start:d,end:d};c&&(--e,++f);return{start:{line:d.line,ch:e},end:{line:d.line,ch:f}}}function oa(){}function y(a){a=a.state.vim;return a.searchState_||(a.searchState_=new oa)}function pa(a){for(var b=!1,c=[],d=0;d<a.length;d++){var e=
a.charAt(d);b||"/"!=e||c.push(d);b="\\"==e}return c}function q(a,b){a.openConfirm?a.openConfirm('<span style="color: red">'+b+'</span> <button type="button">OK</button>',function(){},{bottom:!0}):alert(b)}function P(a,b){var c=(b.prefix||"")+" "+(b.desc||""),d;d=b.prefix;var e=b.desc,f="";d&&(f+='<span style="font-family: monospace">'+d+"</span>");f+='<input type="text"/> <span style="color: #888">';e&&(f=f+'<span style="color: #888">'+e,f+="</span>");d=f;e=b.onClose;a.openDialog?a.openDialog(d,e,
{bottom:!0,value:b.value,onKeyDown:b.onKeyDown,onKeyUp:b.onKeyUp}):e(prompt(c,""))}function Q(a,b,c,d){if(b){var e=y(a);c=!!c;d=!!d;if(!(b instanceof RegExp)){var f=pa(b),g,h;f.length?(g=b.substring(0,f[0]),h=-1!=b.substring(f[0]).indexOf("i")):g=b;g?(d&&(c=/^[^A-Z]*$/.test(g)),b=RegExp(g,c||h?"i":void 0)):b=null}if(b){qa(a,b);a:if(a=e.getQuery(),b instanceof RegExp&&a instanceof RegExp){h=["global","multiline","ignoreCase","source"];for(c=0;c<h.length;c++)if(d=h[c],b[d]!==a[d]){a=!1;break a}a=!0}else a=
!1;if(a)return b;e.setQuery(b);return b}}}function Fa(a){if("^"==a.source.charAt(0))var b=!0;return{token:function(c){if(b&&!c.sol())c.skipToEnd();else{var d=c.match(a,!1);if(d){if(0==d[0].length)return c.next(),"searching";if(!c.sol()&&(c.backUp(1),!a.exec(c.next()+d[0])))return c.next(),null;c.match(a);return"searching"}for(;!c.eol()&&(c.next(),!c.match(a,!1)););}},query:a}}function qa(a,b){var c=y(a).getOverlay();c&&b==c.query||(c&&a.removeOverlay(c),c=Fa(b),a.addOverlay(c),y(a).setOverlay(c))}
function ra(a,b,c,d){void 0===d&&(d=1);return a.operation(function(){for(var e=a.getCursor(),f=a.getSearchCursor(c,e),g=0;g<d;g++){var h=f.find(b);0==g&&(h&&u(f.from(),e))&&(h=f.find(b));if(!h&&(f=a.getSearchCursor(c,b?{line:a.lastLine()}:{line:a.firstLine(),ch:0}),!f.find(b)))return}return f.from()})}function ca(a){a.removeOverlay(y(a).getOverlay());y(a).setOverlay(null)}function da(a){var b=a.getScrollInfo(),c=a.coordsChar({left:0,top:6+b.top},"local");a=a.coordsChar({left:0,top:b.clientHeight-
10+b.top},"local");return{top:c.line,bottom:a.line}}function R(a){for(var b,c,d=[];a;){c=/<\w+-.+?>|<\w+>|./.exec(a);if(null===c)break;b=c[0];a=a.substring(c.index+b.length);d.push(b)}return d}function Ga(a,b,c,d,e,f,g){function h(){a.operation(function(){for(;!m;)k(),l();n()})}function k(){var b=a.getRange(e.from(),e.to()).replace(f,g);e.replace(b)}function l(){if(e.findNext()){var b;b=e.from();var f=c,g=d;"number"!=typeof b&&(b=b.line);b=f instanceof Array?L(b,f):g?b>=f&&b<=g:b==f;b?(a.scrollIntoView(e.from(),
30),a.setSelection(e.from(),e.to()),r=e.from(),m=!1):m=!0}else m=!0}function n(b){b&&b();a.focus();r&&(a.setCursor(r),b=a.state.vim,b.exMode=!1,b.lastHPos=b.lastHSPos=r.ch)}function p(b,c,d){CodeMirror.e_stop(b);switch(CodeMirror.keyName(b)){case "Y":k();l();break;case "N":l();break;case "A":a.operation(h);break;case "L":k();case "Q":case "Esc":case "Ctrl-C":case "Ctrl-[":n(d)}m&&n(d)}a.state.vim.exMode=!0;var m=!1,r=e.from();l();if(m)throw Error("No matches for "+f.source);b?P(a,{prefix:"replace with <strong>"+
g+"</strong> (y/n/a/q/l)",onKeyDown:p}):h()}function S(a){var b=a.state.vim,c=p.macroModeState.inReplay;c||(a.off("change",sa),a.off("cursorActivity",ta),CodeMirror.off(a.getInputField(),"keydown",ua));!c&&1<b.insertModeRepeat&&(va(a,b,b.insertModeRepeat-1,!0),b.lastEditInputState.repeatOverride=b.insertModeRepeat);delete b.insertModeRepeat;a.setCursor(a.getCursor().line,a.getCursor().ch-1,!0);b.insertMode=!1;a.setOption("keyMap","vim");a.toggleOverwrite(!1);CodeMirror.signal(a,"vim-mode-change",
{mode:"normal"})}function sa(a,b){for(var c=p.macroModeState.lastInsertModeChanges;b;){c.expectCursorActivityForChange=!0;if("+input"==b.origin||"paste"==b.origin||void 0===b.origin){var d=b.text.join("\n");c.changes.push(d)}b=b.next}}function ta(){var a=p.macroModeState.lastInsertModeChanges;a.expectCursorActivityForChange?a.expectCursorActivityForChange=!1:a.changes=[]}function ea(a){this.keyName=a}function ua(a){function b(){c.changes.push(new ea(d));return!0}var c=p.macroModeState.lastInsertModeChanges,
d=CodeMirror.keyName(a);-1==d.indexOf("Delete")&&-1==d.indexOf("Backspace")||CodeMirror.lookupKey(d,["vim-insert"],b)}function va(a,b,c,d){function e(){h?E.processAction(a,b,b.lastEditActionCommand):E.evalInput(a,b)}function f(c){0<g.lastInsertModeChanges.changes.length&&(c=b.lastEditActionCommand?c:1,Ha(a,c,g))}var g=p.macroModeState;g.inReplay=!0;var h=!!b.lastEditActionCommand,k=b.inputState;b.inputState=b.lastEditInputState;if(h&&b.lastEditActionCommand.interlaceInsertRepeat)for(var l=0;l<c;l++)e(),
f(1);else d||e(),f(c);b.inputState=k;b.insertMode&&!d&&S(a);g.inReplay=!1}function Ha(a,b,c){function d(b){if("string"==typeof b)CodeMirror.commands[b](a);else b(a);return!0}c=c.lastInsertModeChanges;for(var e=0;e<b;e++)for(var f=0;f<c.changes.length;f++){var g=c.changes[f];if(g instanceof ea)CodeMirror.lookupKey(g.keyName,["vim-insert"],d);else{var h=a.getCursor();a.replaceRange(g,h,h)}}}CodeMirror.defineOption("vimMode",!1,function(a,b){b?(a.setOption("keyMap","vim"),CodeMirror.signal(a,"vim-mode-change",
{mode:"normal"}),a.on("beforeSelectionChange",ha),Y(a)):a.state.vim&&(a.setOption("keyMap","default"),a.off("beforeSelectionChange",ha),a.state.vim=null)});var Ia=/[\d]/,Ja=[/\w/,/[^\w\s]/],Ka=[/\S/],K=X(65,26),T=X(97,26),U=X(48,10),fa="~`!@#$%^&*()_-+=[{}]\\|/?.,<>:;\"'".split(""),wa="Left Right Up Down Space Backspace Esc Home End PageUp PageDown Enter".split(" "),Ea=[].concat(K,T,U,["<",">"]),La=[].concat(K,T,U,["-",'"']),Ba=function(){var a=100,b=-1,c=0,d=0,e=Array(a);return{cachedCursor:void 0,
add:function(f,g,h){function k(c){var d=++b%a,g=e[d];g&&g.clear();e[d]=f.setBookmark(c)}var l=e[b%a];l?(l=l.find())&&!u(l,g)&&k(g):k(g);k(h);c=b;d=b-a+1;0>d&&(d=0)},move:function(f,g){b+=g;b>c?b=c:b<d&&(b=d);var h=e[(a+b)%a];if(h&&!h.find()){var k=0<g?1:-1,l,n=f.getCursor();do if(b+=k,(h=e[(a+b)%a])&&(l=h.find())&&!u(n,l))break;while(b<c&&b>d)}return h}}},Ca=function(){return{macroKeyBuffer:[],latestRegister:void 0,inReplay:!1,lastInsertModeChanges:{changes:[],expectCursorActivityForChange:!1},enteredMacroMode:void 0,
isMacroPlaying:!1,toggle:function(a,b){this.enteredMacroMode?(this.enteredMacroMode(),this.enteredMacroMode=void 0):(this.latestRegister=b,this.enteredMacroMode=a.openDialog("(recording)["+b+"]",null,{bottom:!0}))}}},p,T={buildKeyMap:function(){},getRegisterController:function(){return p.registerController},resetVimGlobalState_:ia,getVimGlobalState_:function(){return p},maybeInitVimState_:Y,InsertModeKey:ea,map:function(a,b){F.map(a,b)},defineEx:function(a,b,c){if(0!==a.indexOf(b))throw Error('(Vim.defineEx) "'+
b+'" is not a prefix of "'+a+'", command not registered');xa[a]=c;F.commandMap_[b]={name:a,shortName:b,type:"api"}},handleKey:function(a,b){var c,d=Y(a),e=p.macroModeState;if(e.enteredMacroMode&&"q"==b)ga.exitMacroRecordMode(),d.inputState=new x;else if("<Esc>"==b)d.inputState=new x,d.visualMode&&B(a);else{d.visualMode||u(a.getCursor("head"),a.getCursor("anchor"))||(d.visualMode=!0,d.visualLine=!1,CodeMirror.signal(a,"vim-mode-change",{mode:"visual"}),a.on("mousedown",B));if("0"!=b||"0"==b&&0===d.inputState.getRepeat())c=
E.matchCommand(b,W,d);if(c)if("keyToKey"==c.type)for(d=0;d<c.toKeys.length;d++)this.handleKey(a,c.toKeys[d]);else e.enteredMacroMode&&(e.isMacroPlaying||e.macroKeyBuffer.push(b)),E.processCommand(a,d,c);else Ia.test(b)&&d.inputState.pushRepeatDigit(b)}},handleEx:function(a,b){F.processCommand(a,b)}};x.prototype.pushRepeatDigit=function(a){this.operator?this.motionRepeat=this.motionRepeat.concat(a):this.prefixRepeat=this.prefixRepeat.concat(a)};x.prototype.getRepeat=function(){var a=0;if(0<this.prefixRepeat.length||
0<this.motionRepeat.length)a=1,0<this.prefixRepeat.length&&(a*=parseInt(this.prefixRepeat.join(""),10)),0<this.motionRepeat.length&&(a*=parseInt(this.motionRepeat.join(""),10));return a};D.prototype={set:function(a,b){this.text=a;this.linewise=!!b},append:function(a,b){b||this.linewise?(this.text+="\n"+a,this.linewise=!0):this.text+=a},clear:function(){this.text="";this.linewise=!1},toString:function(){return this.text}};ja.prototype={pushText:function(a,b,c,d){d&&"\n"==c.charAt(0)&&(c=c.slice(1)+
"\n");d&&"\n"!==c.charAt(c.length-1)&&(c+="\n");var e=this.isValidRegister(a)?this.getRegister(a):null;if(e)H(a)?(e.append(c,d),this.unamedRegister.append(c,d)):(e.set(c,d),this.unamedRegister.set(c,d));else{switch(b){case "yank":this.registers["0"]=new D(c,d);break;case "delete":case "change":-1==c.indexOf("\n")?this.registers["-"]=new D(c,d):(this.shiftNumericRegisters_(),this.registers["1"]=new D(c,d))}this.unamedRegister.set(c,d)}},setRegisterText:function(a,b,c){this.getRegister(a).set(b,c)},
getRegister:function(a){if(!this.isValidRegister(a))return this.unamedRegister;a=a.toLowerCase();this.registers[a]||(this.registers[a]=new D);return this.registers[a]},isValidRegister:function(a){return a&&L(a,La)},shiftNumericRegisters_:function(){for(var a=9;2<=a;a--)this.registers[a]=this.getRegister(""+(a-1))}};var E={matchCommand:function(a,b,c){function d(b){if(f.length<b.keys.length)return e.keyBuffer.push(a),null;"character"==b.keys[f.length-1]&&(e.selectedCharacter=h);e.keyBuffer=[];return b}
for(var e=c.inputState,f=e.keyBuffer.concat(a),g=[],h,k=0;k<b.length;k++){var l=b[k];if(Da(f,l.keys)&&(!e.operator||"action"!=l.type)){if("character"==l.keys[f.length-1]&&(h=f[f.length-1],1<h.length))switch(h){case "<CR>":h="\n";break;case "<Space>":h=" ";break;default:continue}g.push(l)}}if(g.length){if(1==g.length)return d(g[0]);b=c.visualMode?"visual":"normal";c=g[0];for(k=0;k<g.length;k++)if(g[k].context==b){c=g[k];break}return d(c)}e.keyBuffer=[];return null},processCommand:function(a,b,c){b.inputState.repeatOverride=
c.repeatOverride;switch(c.type){case "motion":this.processMotion(a,b,c);break;case "operator":this.processOperator(a,b,c);break;case "operatorMotion":this.processOperatorMotion(a,b,c);break;case "action":this.processAction(a,b,c);break;case "search":this.processSearch(a,b,c);break;case "ex":case "keyToEx":this.processEx(a,b,c)}},processMotion:function(a,b,c){b.inputState.motion=c.motion;b.inputState.motionArgs=M(c.motionArgs);this.evalInput(a,b)},processOperator:function(a,b,c){var d=b.inputState;
if(d.operator){if(d.operator==c.operator){d.motion="expandToLine";d.motionArgs={linewise:!0};this.evalInput(a,b);return}b.inputState=new x}d.operator=c.operator;d.operatorArgs=M(c.operatorArgs);b.visualMode&&this.evalInput(a,b)},processOperatorMotion:function(a,b,c){var d=b.visualMode,e=M(c.operatorMotionArgs);e&&(d&&e.visualLine)&&(b.visualLine=!0);this.processOperator(a,b,c);d||this.processMotion(a,b,c)},processAction:function(a,b,c){var d=b.inputState,e=d.getRepeat(),f=!!e,g=M(c.actionArgs)||{};
d.selectedCharacter&&(g.selectedCharacter=d.selectedCharacter);c.operator&&this.processOperator(a,b,c);c.motion&&this.processMotion(a,b,c);(c.motion||c.operator)&&this.evalInput(a,b);g.repeat=e||1;g.repeatIsExplicit=f;g.registerName=d.registerName;b.inputState=new x;b.lastMotion=null;c.isEdit&&this.recordLastEdit(b,d,c);ga[c.action](a,g,b)},processSearch:function(a,b,c){function d(d,e,f){try{Q(a,d,e,f)}catch(g){q(a,"Invalid regex: "+d);return}E.processMotion(a,b,{type:"motion",motion:"findNext",motionArgs:{forward:!0,
toJumplist:c.searchArgs.toJumplist}})}function e(b){a.scrollTo(n.left,n.top);d(b,!0,!0)}function f(b,c){var d;try{d=Q(a,c,!0,!0)}catch(e){}d?a.scrollIntoView(ra(a,!h,d),30):(ca(a),a.scrollTo(n.left,n.top))}function g(b,c,d){c=CodeMirror.keyName(b);if("Esc"==c||"Ctrl-C"==c||"Ctrl-["==c)Q(a,l),ca(a),a.scrollTo(n.left,n.top),CodeMirror.e_stop(b),d(),a.focus()}if(a.getSearchCursor){var h=c.searchArgs.forward;y(a).setReversed(!h);var k=h?"/":"?",l=y(a).getQuery(),n=a.getScrollInfo();switch(c.searchArgs.querySrc){case "prompt":P(a,
{onClose:e,prefix:k,desc:Ma,onKeyUp:f,onKeyDown:g});break;case "wordUnderCursor":var k=N(a,!1,!0,!1,!0),t=!0;k||(k=N(a,!1,!0,!1,!1),t=!1);if(!k)break;var m=a.getLine(k.start.line).substring(k.start.ch,k.end.ch),m=t?"\\b"+m+"\\b":m.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1");p.jumpList.cachedCursor=a.getCursor();a.setCursor(k.start);d(m,!0,!1)}}},processEx:function(a,b,c){function d(b){F.processCommand(a,b)}function e(b,c,d){c=CodeMirror.keyName(b);if("Esc"==c||"Ctrl-C"==c||"Ctrl-["==c)CodeMirror.e_stop(b),
d(),a.focus()}"keyToEx"==c.type?F.processCommand(a,c.exArgs.input):b.visualMode?P(a,{onClose:d,prefix:":",value:"'<,'>",onKeyDown:e}):P(a,{onClose:d,prefix:":",onKeyDown:e})},evalInput:function(a,b){var c=b.inputState,d=c.motion,e=c.motionArgs||{},f=c.operator,g=c.operatorArgs||{},h=c.registerName,k=a.getCursor("head"),l=a.getCursor("anchor"),n={line:k.line,ch:k.ch},q={line:n.line,ch:n.ch},m,r;f&&this.recordLastEdit(b,c);r=void 0!==c.repeatOverride?c.repeatOverride:c.getRepeat();if(0<r&&e.explicitRepeat)e.repeatIsExplicit=
!0;else if(e.noRepeat||!e.explicitRepeat&&0===r)r=1,e.repeatIsExplicit=!1;c.selectedCharacter&&(e.selectedCharacter=g.selectedCharacter=c.selectedCharacter);e.repeat=r;b.inputState=new x;if(d){m=G[d](a,e,b);b.lastMotion=G[d];if(!m)return;e.toJumplist&&(d=p.jumpList,(c=d.cachedCursor)?(u(c,m)||p.jumpList.add(a,c,m),delete d.cachedCursor):u(q,m)||p.jumpList.add(a,q,m));m instanceof Array&&(n=m[0],m=m[1]);m||(m={ch:n.ch,line:n.line});b.visualMode?(s(l,k)&&(u(l,m)||s(m,l))?l.ch+=1:s(k,l)&&(u(l,m)||s(l,
m))&&(l.ch-=1),k=m,b.visualLine&&(s(l,k)?(l.ch=0,d=a.lastLine(),k.line>d&&(k.line=d),k.ch=t(a,k.line)):(k.ch=0,l.ch=t(a,l.line))),a.setSelection(l,k),I(a,b,"<",s(l,k)?l:k),I(a,b,">",s(l,k)?k:l)):f||(m=C(a,m),a.setCursor(m.line,m.ch))}if(f){d=!1;b.lastMotion=null;g.repeat=r;b.visualMode&&(n=l,m=k,e.inclusive=!0);s(m,n)&&(k=n,n=m,m=k,d=!0);!e.inclusive||b.visualMode&&d||m.ch++;if(k=e.linewise||b.visualMode&&b.visualLine)e=m,n.ch=0,e.ch=0,e.line++;else if(e.forward&&(e=m,l=a.getRange(n,e),/\n\s*$/.test(l))){l=
l.split("\n");l.pop();for(r=l.pop();0<l.length&&r&&/^\s*$/.test(r);r=l.pop())e.line--,e.ch=0;r?(e.line--,e.ch=t(a,e.line)):e.ch=0}g.registerName=h;g.linewise=k;Na[f](a,g,b,n,m,q);b.visualMode&&B(a)}},recordLastEdit:function(a,b,c){var d=p.macroModeState;d.inReplay||(a.lastEditInputState=b,a.lastEditActionCommand=c,d.lastInsertModeChanges.changes=[],d.lastInsertModeChanges.expectCursorActivityForChange=!1)}},G={moveToTopLine:function(a,b){var c=da(a).top+b.repeat-1;return{line:c,ch:v(a.getLine(c))}},
moveToMiddleLine:function(a){var b=da(a),b=Math.floor(0.5*(b.top+b.bottom));return{line:b,ch:v(a.getLine(b))}},moveToBottomLine:function(a,b){var c=da(a).bottom-b.repeat+1;return{line:c,ch:v(a.getLine(c))}},expandToLine:function(a,b){return{line:a.getCursor().line+b.repeat-1,ch:Infinity}},findNext:function(a,b){var c=y(a),d=c.getQuery();if(d){var e=!b.forward,e=c.isReversed()?!e:e;qa(a,d);return ra(a,e,d,b.repeat)}},goToMark:function(a,b,c){return(a=c.marks[b.selectedCharacter])?a.find():null},jumpToMark:function(a,
b,c){for(var d=a.getCursor(),e=0;e<b.repeat;e++){var f=d,g;for(g in c.marks)if(/^[a-z]$/.test(g)){var h=c.marks[g].find();if(b.forward?!s(h,f):!s(f,h))if(!b.linewise||h.line!=f.line){var k=u(f,d),l=b.forward?la(f,h,d):la(d,h,f);if(k||l)d=h}}}b.linewise&&(d.ch=v(a.getLine(d.line)));return d},moveByCharacters:function(a,b){var c=a.getCursor(),d=b.repeat;return{line:c.line,ch:b.forward?c.ch+d:c.ch-d}},moveByLines:function(a,b,c){var d=a.getCursor(),e=d.ch;switch(c.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:e=
c.lastHPos;break;default:c.lastHPos=e}var f=b.repeat+(b.repeatOffset||0),f=b.forward?d.line+f:d.line-f,g=a.firstLine(),h=a.lastLine();if(!(f<g&&d.line==g||f>h&&d.line==h))return b.toFirstChar&&(e=v(a.getLine(f)),c.lastHPos=e),c.lastHSPos=a.charCoords({line:f,ch:e},"div").left,{line:f,ch:e}},moveByDisplayLines:function(a,b,c){var d=a.getCursor();switch(c.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:c.lastHSPos=
a.charCoords(d,"div").left}var e=b.repeat,d=a.findPosV(d,b.forward?e:-e,"line",c.lastHSPos);d.hitSide&&(b.forward?b={top:a.charCoords(d,"div").top+8,left:c.lastHSPos}:(b=a.charCoords({line:a.firstLine(),ch:0},"div"),b.left=c.lastHSPos),d=a.coordsChar(b,"div"));c.lastHPos=d.ch;return d},moveByPage:function(a,b){var c=a.getCursor(),d=b.repeat;a.moveV(b.forward?d:-d,"page");d=a.getCursor();a.setCursor(c);return d},moveByParagraph:function(a,b){for(var c=a.getCursor().line,d=b.repeat,e=b.forward?1:-1,
f=0;f<d&&!(!b.forward&&c===a.firstLine()||b.forward&&c==a.lastLine());f++)for(c+=e;c!==a.firstLine()&&c!=a.lastLine()&&a.getLine(c);)c+=e;return{line:c,ch:0}},moveByScroll:function(a,b,c){var d=a.getScrollInfo(),e=null;(e=b.repeat)||(e=d.clientHeight/(2*a.defaultTextHeight()));var f=a.charCoords(a.getCursor(),"local");b.repeat=e;e=G.moveByDisplayLines(a,b,c);if(!e)return null;b=a.charCoords(e,"local");a.scrollTo(null,d.top+b.top-f.top);return e},moveByWords:function(a,b){var c;var d=b.repeat;c=!!b.forward;
var e=!!b.wordEnd,f=!!b.bigWord,g=a.getCursor(),h=g.line,k=g.ch,l=[];(c&&!e||!c&&e)&&d++;for(var n=!(c&&e),p=0;p<d;p++){var m;b:{m=a;var r=c,J=f,s=n,w=g.line,z=g.ch,A=m.getLine(w),q=r?1:-1,J=J?Ka:Ja;if(s&&""==A){w+=q;A=m.getLine(w);if(!(w>=m.firstLine()&&w<=m.lastLine())){m=null;break b}z=r?0:A.length}for(;;){if(s&&""==A){m={from:0,to:0,line:w};break b}for(var u=r=0<q?A.length:-1,v=r;z!=r;){for(var y=!1,x=0;x<J.length&&!y;++x)if(J[x].test(A.charAt(z))){for(u=z;z!=r&&J[x].test(A.charAt(z));)z+=q;v=
z;y=u!=v;if(u!=g.ch||w!=g.line||v!=u+q){m={from:Math.min(u,v+1),to:Math.max(u,v),line:w};break b}}y||(z+=q)}w+=q;if(!(w>=m.firstLine()&&w<=m.lastLine())){m=null;break b}A=m.getLine(w);z=0<q?0:A.length}throw Error("The impossible happened.");}if(!m){f=t(a,a.lastLine());l.push(c?{line:a.lastLine(),from:f,to:f}:{line:0,from:0,to:0});break}l.push(m);g={line:m.line,ch:c?m.to-1:m.from}}d=l.length!=d;f=l[0];n=l.pop();c&&!e?(d||f.from==k&&f.line==h||(n=l.pop()),c={line:n.line,ch:n.from}):c&&e?c={line:n.line,
ch:n.to-1}:!c&&e?(d||f.to==k&&f.line==h||(n=l.pop()),c={line:n.line,ch:n.to}):c={line:n.line,ch:n.from};return c},moveTillCharacter:function(a,b){var c=$(a,b.repeat,b.forward,b.selectedCharacter),d=b.forward?-1:1;ma(d,b);if(!c)return a.getCursor();c.ch+=d;return c},moveToCharacter:function(a,b){var c=b.repeat;ma(0,b);return $(a,c,b.forward,b.selectedCharacter)||a.getCursor()},moveToSymbol:function(a,b){var c;c=b.repeat;var d=b.forward,e=b.selectedCharacter,f=a.getCursor(),g=d?1:-1,h=d?a.lineCount():
-1,k=f.ch,l=f.line,n=a.getLine(l),d={lineText:n,nextCh:n.charAt(k),lastCh:null,index:k,symb:e,reverseSymb:(d?{")":"(","}":"{"}:{"(":")","{":"}"})[e],forward:d,depth:0,curMoveThrough:!1};if(k=Oa[e]){e=ya[k].init;k=ya[k].isComplete;for(e&&e(d);l!==h&&c;)d.index+=g,d.nextCh=d.lineText.charAt(d.index),d.nextCh||(l+=g,d.lineText=a.getLine(l)||"",0<g?d.index=0:(e=d.lineText.length,d.index=0<e?e-1:0),d.nextCh=d.lineText.charAt(d.index)),k(d)&&(f.line=l,f.ch=d.index,c--);c=d.nextCh||d.curMoveThrough?{line:l,
ch:d.index}:f}else c=f;return c||a.getCursor()},moveToColumn:function(a,b,c){b=b.repeat;c.lastHPos=b-1;c.lastHSPos=a.charCoords(a.getCursor(),"div").left;c=a.getCursor().line;return C(a,{line:c,ch:b-1})},moveToEol:function(a,b,c){var d=a.getCursor();c.lastHPos=Infinity;b={line:d.line+b.repeat-1,ch:Infinity};d=a.clipPos(b);d.ch--;c.lastHSPos=a.charCoords(d,"div").left;return b},moveToFirstNonWhiteSpaceCharacter:function(a){var b=a.getCursor();return{line:b.line,ch:v(a.getLine(b.line))}},moveToMatchedSymbol:function(a){var b=
a.getCursor(),c=b.line,d=b.ch,e=a.getLine(c),f;f=a.getTokenAt(b).type;var g=O(f);do if((f=e.charAt(d++))&&-1!="()[]{}".indexOf(f)){var h=a.getTokenAt({line:c,ch:d}).type,h=O(h);if(g>=h)break}while(f);return f?aa(a,{line:c,ch:d-1},f):b},moveToStartOfLine:function(a){return{line:a.getCursor().line,ch:0}},moveToLineOrEdgeOfDocument:function(a,b){var c=b.forward?a.lastLine():a.firstLine();b.repeatIsExplicit&&(c=b.repeat-a.getOption("firstLineNumber"));return{line:c,ch:v(a.getLine(c))}},textObjectManipulation:function(a,
b){var c=b.selectedCharacter;if(!za[c])return null;c=za[c](a,!b.textObjectInner);return[c.start,c.end]},repeatLastCharacterSearch:function(a,b){var c=p.lastChararacterSearch,d=b.repeat,e=b.forward===c.forward,f=(c.increment?1:0)*(e?-1:1);a.moveH(-f,"char");b.inclusive=e?!0:!1;c=$(a,d,e,c.selectedCharacter);if(!c)return a.moveH(f,"char"),a.getCursor();c.ch+=f;return c}},Na={change:function(a,b,c,d,e){p.registerController.pushText(b.registerName,"change",a.getRange(d,e),b.linewise);b.linewise?(b=e.line>
a.lastLine()?"":"\n",a.replaceRange(b,d,e),a.indentLine(d.line,"smart"),d.ch=null):(b=a.getRange(d,e),/^\s*$/.test(b)||(b=/\s+$/.exec(b))&&(e=Z(e,0,-b[0].length)),a.replaceRange("",d,e));ga.enterInsertMode(a,{},a.state.vim);a.setCursor(d)},"delete":function(a,b,c,d,e){b.linewise&&(e.line>a.lastLine()&&d.line>a.firstLine())&&(d.line--,d.ch=t(a,d.line));p.registerController.pushText(b.registerName,"delete",a.getRange(d,e),b.linewise);a.replaceRange("",d,e);b.linewise?a.setCursor(G.moveToFirstNonWhiteSpaceCharacter(a)):
a.setCursor(d)},indent:function(a,b,c,d,e){var f=d.line;e=e.line;c=c.visualMode?b.repeat:1;for(b.linewise&&e--;f<=e;f++)for(var g=0;g<c;g++)a.indentLine(f,b.indentRight);a.setCursor(d);a.setCursor(G.moveToFirstNonWhiteSpaceCharacter(a))},swapcase:function(a,b,c,d,e,f){c=a.getRange(d,e);for(var g="",h=0;h<c.length;h++)var k=c.charAt(h),g=g+(H(k)?k.toLowerCase():k.toUpperCase());a.replaceRange(g,d,e);b.shouldMoveCursor||a.setCursor(f)},yank:function(a,b,c,d,e,f){p.registerController.pushText(b.registerName,
"yank",a.getRange(d,e),b.linewise);a.setCursor(f)}},ga={jumpListWalk:function(a,b,c){c.visualMode||(c=b.repeat,b=(b=(b=p.jumpList.move(a,b.forward?c:-c))?b.find():void 0)?b:a.getCursor(),a.setCursor(b))},scrollToCursor:function(a,b){var c=a.getCursor().line,d=a.charCoords({line:c,ch:0},"local"),c=a.getScrollInfo().clientHeight,e=d.top,d=d.bottom-e;switch(b.position){case "center":e=e-c/2+d;break;case "bottom":e=e-c+1.4*d;break;case "top":e+=0.4*d}a.scrollTo(null,e)},replayMacro:function(a,b){var c=
b.selectedCharacter,d=b.repeat,e=p.macroModeState;"@"==c&&(c=e.latestRegister);var f,g,h=p.registerController.getRegister(c).toString(),c=e.macroKeyBuffer;e.isMacroPlaying||(e.macroKeyBuffer.length=0);do{f=/<\w+-.+?>|<\w+>|./.exec(h);if(null===f)break;g=f[0];h=h.substring(f.index+g.length);c.push(g)}while(h);for(;d--;){f=a;g=e;h=c;g.isMacroPlaying=!0;for(var k=0,l=h.length;k<l;k++)CodeMirror.Vim.handleKey(f,h[k]);g.isMacroPlaying=!1}},exitMacroRecordMode:function(){var a=p.macroModeState;a.toggle();
var b=a.latestRegister,a=a.macroKeyBuffer.join("");p.registerController.setRegisterText(b,a)},enterMacroRecordMode:function(a,b){var c=p.macroModeState;c.toggle(a,b.selectedCharacter);c.isMacroPlaying||(c.macroKeyBuffer.length=0)},enterInsertMode:function(a,b,c){a.getOption("readOnly")||(c.insertMode=!0,c.insertModeRepeat=b&&b.repeat||1,c=b?b.insertAt:null,"eol"==c?(c=a.getCursor(),c={line:c.line,ch:t(a,c.line)},a.setCursor(c)):"charAfter"==c?a.setCursor(Z(a.getCursor(),0,1)):"firstNonBlank"==c&&
a.setCursor(G.moveToFirstNonWhiteSpaceCharacter(a)),a.setOption("keyMap","vim-insert"),b&&b.replace?(a.toggleOverwrite(!0),a.setOption("keyMap","vim-replace"),CodeMirror.signal(a,"vim-mode-change",{mode:"replace"})):(a.setOption("keyMap","vim-insert"),CodeMirror.signal(a,"vim-mode-change",{mode:"insert"})),p.macroModeState.inReplay||(a.on("change",sa),a.on("cursorActivity",ta),CodeMirror.on(a.getInputField(),"keydown",ua)))},toggleVisualMode:function(a,b,c){var d=b.repeat,e=a.getCursor();c.visualMode?
(e=a.getCursor("anchor"),d=a.getCursor("head"),!c.visualLine&&b.linewise?(c.visualLine=!0,e.ch=s(e,d)?0:t(a,e.line),d.ch=s(e,d)?t(a,d.line):0,a.setSelection(e,d),CodeMirror.signal(a,"vim-mode-change",{mode:"visual",subMode:"linewise"})):c.visualLine&&!b.linewise?(c.visualLine=!1,CodeMirror.signal(a,"vim-mode-change",{mode:"visual"})):B(a)):(a.on("mousedown",B),c.visualMode=!0,c.visualLine=!!b.linewise,c.visualLine?(e.ch=0,d=C(a,{line:e.line+d-1,ch:t(a,e.line)},!0)):d=C(a,{line:e.line,ch:e.ch+d},!0),
b.repeatIsExplicit||c.visualLine?a.setSelection(e,d):(a.setCursor(d),a.setSelection(d,e)),CodeMirror.signal(a,"vim-mode-change",{mode:"visual",subMode:c.visualLine?"linewise":""}));I(a,c,"<",s(e,d)?e:d);I(a,c,">",s(e,d)?d:e)},joinLines:function(a,b,c){var d,e;c.visualMode?(d=a.getCursor("anchor"),e=a.getCursor("head"),e.ch=t(a,e.line)-1):(b=Math.max(b.repeat,2),d=a.getCursor(),e=C(a,{line:d.line+b-1,ch:Infinity}));var f=0;a.operation(function(){for(var b=d.line;b<e.line;b++){f=t(a,d.line);var c={line:d.line+
1,ch:t(a,d.line+1)},k=a.getRange(d,c),k=k.replace(/\n\s*/g," ");a.replaceRange(k,d,c)}a.setCursor({line:d.line,ch:f})})},newLineAndEnterInsertMode:function(a,b,c){c.insertMode=!0;var d=a.getCursor();d.line!==a.firstLine()||b.after?(d.line=b.after?d.line:d.line-1,d.ch=t(a,d.line),a.setCursor(d),(CodeMirror.commands.newlineAndIndentContinueComment||CodeMirror.commands.newlineAndIndent)(a)):(a.replaceRange("\n",{line:a.firstLine(),ch:0}),a.setCursor(a.firstLine(),0));this.enterInsertMode(a,{repeat:b.repeat},
c)},paste:function(a,b){var c=a.getCursor(),d=p.registerController.getRegister(b.registerName);if(d.text){for(var e="",f=0;f<b.repeat;f++)e+=d.text;(d=d.linewise)?b.after?(e="\n"+e.slice(0,e.length-1),c.ch=t(a,c.line)):c.ch=0:c.ch+=b.after?1:0;a.replaceRange(e,c);d&&b.after?e={line:c.line+1,ch:v(a.getLine(c.line+1))}:d&&!b.after?e={line:c.line,ch:v(a.getLine(c.line))}:!d&&b.after?(c=a.indexFromPos(c),e=a.posFromIndex(c+e.length-1)):(c=a.indexFromPos(c),e=a.posFromIndex(c+e.length));a.setCursor(e)}},
undo:function(a,b){a.operation(function(){ka(a,CodeMirror.commands.undo,b.repeat)();a.setCursor(a.getCursor("anchor"))})},redo:function(a,b){ka(a,CodeMirror.commands.redo,b.repeat)()},setRegister:function(a,b,c){c.inputState.registerName=b.selectedCharacter},setMark:function(a,b,c){I(a,c,b.selectedCharacter,a.getCursor())},replace:function(a,b,c){var d=b.selectedCharacter,e=a.getCursor(),f;c.visualMode?(e=a.getCursor("start"),f=a.getCursor("end"),f=a.clipPos({line:f.line,ch:f.ch+1})):(f=a.getLine(e.line),
b=e.ch+b.repeat,b>f.length&&(b=f.length),f={line:e.line,ch:b});"\n"==d?(c.visualMode||a.replaceRange("",e,f),(CodeMirror.commands.newlineAndIndentContinueComment||CodeMirror.commands.newlineAndIndent)(a)):(b=a.getRange(e,f),b=b.replace(/[^\n]/g,d),a.replaceRange(b,e,f),c.visualMode?(a.setCursor(e),B(a)):a.setCursor(Z(f,0,-1)))},incrementNumberToken:function(a,b){for(var c=a.getCursor(),d=a.getLine(c.line),e=/-?\d+/g,f,g,h,k;null!==(f=e.exec(d))&&!(k=f[0],g=f.index,h=g+k.length,c.ch<h););!b.backtrack&&
h<=c.ch||!k||(d=b.increase?1:-1,d=parseInt(k)+d*b.repeat,k={ch:g,line:c.line},h={ch:h,line:c.line},d=d.toString(),a.replaceRange(d,k,h),a.setCursor({line:c.line,ch:g+d.length-1}))},repeatLastEdit:function(a,b,c){if(c.lastEditInputState){var d=b.repeat;d&&b.repeatIsExplicit?c.lastEditInputState.repeatOverride=d:d=c.lastEditInputState.repeatOverride||d;va(a,c,d,!1)}}},za={w:function(a,b){return N(a,b,!0,!1)},W:function(a,b){return N(a,b,!0,!0)},"{":function(a,b){return ba(a,"}",b)},"(":function(a,b){return ba(a,
")",b)},"[":function(a,b){return ba(a,"]",b)},"'":function(a,b){return na(a,"'",b)},'"':function(a,b){return na(a,'"',b)}},Oa={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},ya={bracket:{isComplete:function(a){if(a.nextCh===a.symb){if(a.depth++,1<=a.depth)return!0}else a.nextCh===a.reverseSymb&&a.depth--;return!1}},section:{init:function(a){a.curMoveThrough=!0;a.symb=(a.forward?"]":"[")===a.symb?
"{":"}"},isComplete:function(a){return 0===a.index&&a.nextCh===a.symb}},comment:{isComplete:function(a){var b="*"===a.lastCh&&"/"===a.nextCh;a.lastCh=a.nextCh;return b}},method:{init:function(a){a.symb="m"===a.symb?"{":"}";a.reverseSymb="{"===a.symb?"}":"{"},isComplete:function(a){return a.nextCh===a.symb?!0:!1}},preprocess:{init:function(a){a.index=0},isComplete:function(a){if("#"===a.nextCh){var b=a.lineText.match(/#(\w+)/)[1];if("endif"===b){if(a.forward&&0===a.depth)return!0;a.depth++}else if("if"===
b){if(!a.forward&&0===a.depth)return!0;a.depth--}if("else"===b&&0===a.depth)return!0}return!1}}};oa.prototype={getQuery:function(){return p.query},setQuery:function(a){p.query=a},getOverlay:function(){return this.searchOverlay},setOverlay:function(a){this.searchOverlay=a},isReversed:function(){return p.isReversed},setReversed:function(a){p.isReversed=a}};var Ma="(Javascript regexp)",Aa=[{name:"map",type:"builtIn"},{name:"write",shortName:"w",type:"builtIn"},{name:"undo",shortName:"u",type:"builtIn"},
{name:"redo",shortName:"red",type:"builtIn"},{name:"sort",shortName:"sor",type:"builtIn"},{name:"substitute",shortName:"s",type:"builtIn"},{name:"nohlsearch",shortName:"noh",type:"builtIn"},{name:"delmarks",shortName:"delm",type:"builtin"}];V.ExCommandDispatcher=function(){this.buildCommandMap_()};V.ExCommandDispatcher.prototype={processCommand:function(a,b){a.state.vim.visualMode&&B(a);var c=new CodeMirror.StringStream(b),d={};d.input=b;try{this.parseInput_(a,c,d)}catch(e){q(a,e);return}var f;if(d.commandName){var g=
this.matchCommand_(d.commandName);if(g){f=g.name;this.parseCommandArgs_(c,d,g);if("exToKey"==g.type){for(c=0;c<g.toKeys.length;c++)CodeMirror.Vim.handleKey(a,g.toKeys[c]);return}if("exToEx"==g.type){this.processCommand(a,g.toInput);return}}}else void 0!==d.line&&(f="move");if(f)try{xa[f](a,d)}catch(h){q(a,h)}else q(a,'Not an editor command ":'+b+'"')},parseInput_:function(a,b,c){b.eatWhile(":");b.eat("%")?(c.line=a.firstLine(),c.lineEnd=a.lastLine()):(c.line=this.parseLineSpec_(a,b),void 0!==c.line&&
b.eat(",")&&(c.lineEnd=this.parseLineSpec_(a,b)));a=b.match(/^(\w+)/);c.commandName=a?a[1]:b.match(/.*/)[0];return c},parseLineSpec_:function(a,b){var c=b.match(/^(\d+)/);if(c)return parseInt(c[1],10)-1;switch(b.next()){case ".":return a.getCursor().line;case "$":return a.lastLine();case "'":if((c=a.state.vim.marks[b.next()])&&c.find())return c.find().line;throw Error("Mark not set");default:b.backUp(1)}},parseCommandArgs_:function(a,b,c){a.eol()||(b.argString=a.match(/.*/)[0],a=c.argDelimiter||/\s+/,
c=b.argString,c=c.trim?c.trim():c.replace(/^\s+|\s+$/g,""),a=c.split(a),a.length&&a[0]&&(b.args=a))},matchCommand_:function(a){for(var b=a.length;0<b;b--){var c=a.substring(0,b);if(this.commandMap_[c]&&(c=this.commandMap_[c],0===c.name.indexOf(a)))return c}return null},buildCommandMap_:function(){this.commandMap_={};for(var a=0;a<Aa.length;a++){var b=Aa[a];this.commandMap_[b.shortName||b.name]=b}},map:function(a,b){if(":"!=a&&":"==a.charAt(0)){var c=a.substring(1);":"!=b&&":"==b.charAt(0)?this.commandMap_[c]=
{name:c,type:"exToEx",toInput:b.substring(1)}:this.commandMap_[c]={name:c,type:"exToKey",toKeys:R(b)}}else":"!=b&&":"==b.charAt(0)?W.unshift({keys:R(a),type:"keyToEx",exArgs:{input:b.substring(1)}}):W.unshift({keys:R(a),type:"keyToKey",toKeys:R(b)})}};var xa={map:function(a,b){var c=b.args;!c||2>c.length?a&&q(a,"Invalid mapping: "+b.input):F.map(c[0],c[1],a)},move:function(a,b){E.processCommand(a,a.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,
linewise:!0},repeatOverride:b.line+1})},sort:function(a,b){function c(a,b){if(d){var c;c=a;a=b;b=c}e&&(a=a.toLowerCase(),b=b.toLowerCase());c=g&&n.exec(a);var f=g&&n.exec(b);if(!c)return a<b?-1:1;c=parseInt((c[1]+c[2]).toLowerCase(),p);f=parseInt((f[1]+f[2]).toLowerCase(),p);return c-f}var d,e,f,g;(function(){if(b.argString){var a=new CodeMirror.StringStream(b.argString);a.eat("!")&&(d=!0);if(!a.eol()){if(!a.eatSpace())throw Error("invalid arguments "+a.match(/.*/)[0]);var c=a.match(/[a-z]+/);if(c){c=
c[0];e=-1!=c.indexOf("i");f=-1!=c.indexOf("u");var h=-1!=c.indexOf("d")&&1,k=-1!=c.indexOf("x")&&1,c=-1!=c.indexOf("o")&&1;if(1<h+k+c)throw Error("invalid arguments");g=h&&"decimal"||k&&"hex"||c&&"octal"}if(a.eatSpace()&&a.match(/\/.*\//))throw Error("patterns not supported");}}})();var h=b.line||a.firstLine(),k=b.lineEnd||b.line||a.lastLine();if(h!=k){var h={line:h,ch:0},k={line:k,ch:t(a,k)},l=a.getRange(h,k).split("\n"),n="decimal"==g?/(-?)([\d]+)/:"hex"==g?/(-?)(?:0x)?([0-9a-f]+)/i:"octal"==g?
/([0-7]+)/:null,p="decimal"==g?10:"hex"==g?16:"octal"==g?8:null,m=[],r=[];if(g)for(var q=0;q<l.length;q++)n.exec(l[q])?m.push(l[q]):r.push(l[q]);else r=l;m.sort(c);r.sort(c);l=d?m.concat(r):r.concat(m);if(f)for(var m=l,s,l=[],q=0;q<m.length;q++)m[q]!=s&&l.push(m[q]),s=m[q];a.replaceRange(l.join("\n"),h,k)}},substitute:function(a,b){if(!a.getSearchCursor)throw Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.");var c=b.argString,d=pa(c);if(0!==
d[0])q(a,"Substitutions should be of the form :s/pattern/replace/");else{var e=c.substring(d[0]+1,d[1]),f="",g,h,k=!1;d[1]&&(f=c.substring(d[1]+1,d[2]));d[2]&&(h=c.substring(d[2]+1).split(" "),g=h[0],h=parseInt(h[1]));g&&(-1!=g.indexOf("c")&&(k=!0,g.replace("c","")),e=e+"/"+g);if(e)try{Q(a,e,!0,!0)}catch(l){q(a,"Invalid regex: "+e);return}e=y(a).getQuery();g=void 0!==b.line?b.line:a.getCursor().line;c=b.lineEnd||g;h&&(g=c,c=g+h-1);h=C(a,{line:g,ch:0});h=a.getSearchCursor(e,h);Ga(a,k,g,c,h,e,f)}},
redo:CodeMirror.commands.redo,undo:CodeMirror.commands.undo,write:function(a){CodeMirror.commands.save?CodeMirror.commands.save(a):a.save()},nohlsearch:function(a){ca(a)},delmarks:function(a,b){if(b.argString&&b.argString.trim())for(var c=a.state.vim,d=new CodeMirror.StringStream(b.argString.trim());!d.eol();){d.eatSpace();var e=d.pos;if(!d.match(/[a-zA-Z]/,!1)){q(a,"Invalid argument: "+b.argString.substring(e));break}var f=d.next();if(d.match("-",!0)){if(!d.match(/[a-zA-Z]/,!1)){q(a,"Invalid argument: "+
b.argString.substring(e));break}var g=d.next();if(/^[a-z]$/.test(f)&&/^[a-z]$/.test(g)||H(f)&&H(g)){f=f.charCodeAt(0);g=g.charCodeAt(0);if(f>=g){q(a,"Invalid argument: "+b.argString.substring(e));break}for(e=0;e<=g-f;e++){var h=String.fromCharCode(f+e);delete c.marks[h]}}else{q(a,"Invalid argument: "+f+"-");break}}else delete c.marks[f]}else q(a,"Argument required")}},F=new V.ExCommandDispatcher;CodeMirror.keyMap.vim=function(){function a(a){return function(b){CodeMirror.Vim.handleKey(b,a)}}function b(b,
e){for(var f=0;f<b.length;f++){var g=b[f];!e&&L(g,fa)&&(g="'"+g+"'");var h=e,k=b[f];H(k)&&("Shift"==h?h=null:k=k.toLowerCase());h&&(k=h.charAt(0)+"-"+k);k=(h={Enter:"CR",Backspace:"BS",Delete:"Del"}[k])?h:k;k=1<k.length?"<"+k+">":k;c[e?e+"-"+g:g]=a(k)}}var c={nofallthrough:!0,disableInput:!0,style:"fat-cursor"};b(K);b(K,"Shift");b(K,"Ctrl");b(fa);b(fa,"Ctrl");b(U);b(U,"Ctrl");b(wa);b(wa,"Ctrl");return c}();CodeMirror.keyMap["vim-insert"]={Esc:S,"Ctrl-[":S,"Ctrl-C":S,"Ctrl-N":"autocomplete","Ctrl-P":"autocomplete",
Enter:function(a){(CodeMirror.commands.newlineAndIndentContinueComment||CodeMirror.commands.newlineAndIndent)(a)},fallthrough:["default"]};CodeMirror.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"]};ia();return T};CodeMirror.Vim=V()})();
